<div class="page-container">
    <div class="page-header">
        <h2>Manage All Offers</h2>
        <h3>Review and remove carpool offers from all users.</h3>
    </div>

    <div class="carpool-grid">

        <% if (carpools.length === 0) { %>
            <p>No carpool offers to manage.</p>
        <% } %>

        <% carpools.forEach(carpool => { %>

            <div class="carpool-card">

                <div>
                    <% 
                        const rawTime = carpool.time;
                        let displayTime = 'Not set';
                        if (typeof rawTime === 'string' && /^\d{1,2}:\d{2}/.test(rawTime)) {
                            displayTime = rawTime;
                        } else {
                            const t = new Date(rawTime);
                            if (!isNaN(t.getTime())) {
                                displayTime = t.toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });
                            } else if (carpool.createdAt) {
                                const c = new Date(carpool.createdAt);
                                if (!isNaN(c.getTime())) {
                                    displayTime = c.toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });
                                }
                            }
                        }
                    %>
                    <h4><%= carpool.carName %></h4>
                    <p><strong>From:</strong> <%= carpool.location %></p>
                    <p><strong>Time:</strong> <%= displayTime %></p>
                    <p><strong>Price:</strong> â‚¹<%= carpool.price %></p>

                    <p><strong>Driver:</strong> 
                        <%= carpool.userId?.name %> 
                        (<%= carpool.userId?.email %>)
                    </p>
                </div>

                <div class="card-footer">
                    <form action="/admin/offers/<%= carpool._id %>?_method=DELETE" method="POST">
                        <button type="submit" class="btn btn-danger">Delete Offer</button>
                    </form>
                </div>

            </div>

        <% }); %>

    </div>
</div>
